{% extends "base.html" %}
{% block title %}Home - GrantPal{% endblock %}
{% block content %}
<style>
/* ========= Base Layout (fix right-side weirdness) ========= */
html, body { overflow-x: hidden; max-width: 100vw; }
body {
  min-height: 100vh;
  font-family: 'Roboto', sans-serif;
  background-color: #ffffff;
}
h1, h2, h3, h4, h5, h6 { font-family: 'Averia Serif Libre', cursive; }

/* Center page content and add safe side padding */
.home-page .container-fluid {
  max-width: 1400px;        /* keep a clean max width on large screens */
  margin: 0 auto;           /* center the whole page */
  padding: 0 16px;          /* symmetric side padding so nothing hugs edges */
}

/* Reduce Bootstrapâ€™s default gutter to avoid overflow in tight layouts */
.home-page .row { --bs-gutter-x: 1rem; }

/* ===== Main Content ===== */
.home-page .main-content { padding: 20px 0; }

/* ===== Card Styling ===== */
.home-page .card {
  border: none; border-radius: 16px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
}
.home-page .card:hover { transform: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

/* ===== Inputs & Buttons ===== */
.home-page .form-select, .home-page .form-control {
  border-radius: 12px; font-size: 0.85rem; padding: 0.4rem 0.6rem; border: 1px solid #dee2e6;
}
.home-page .btn-outline-primary, .home-page .btn-outline-secondary { border-radius: 12px; font-size: 0.85rem; }
.home-page .btn-outline-primary { color: #5865F2; border-color: #5865F2; }
.home-page .btn-outline-primary:hover { background-color: #5865F2; color: white; }

/* ===== Badge and Task List ===== */
.home-page .badge.bg-success { background-color: #2ecc71 !important; font-size: 0.85rem; padding: 0.35em 0.65em; border-radius: 8px; }
.home-page .list-group-item { border: none; border-radius: 10px; background-color: #f8f9fa; margin-bottom: 0.5rem; font-size: 0.9rem; }

/* ===== Typography Tweaks ===== */
h3, h5, h6 { font-family: 'Inter', sans-serif; font-weight: 600; }
.home-page .table th { width: 250px; background-color: #f8f9fa; font-weight: 600; vertical-align: top; }
.home-page .table td ul { padding-left: 1.25rem; margin: 0; list-style-type: disc; }
.home-page .table td ul li { margin-bottom: 0.25rem; line-height: 1.4; }

/* ===== Icons ===== */
.home-page .CheckerPalIcon, .home-page .DeadlinePalIcon, .home-page .AnswerPalIcon { display: block; width: 60px; height: auto; }
.home-page .CheckerPalIcon { transform: rotate(-8deg); }
.home-page .DeadlinePalIcon { transform: rotate(30deg); }
.home-page .grantpal-icons { display: flex; flex-direction: row; gap: 10px; padding-top: 50px; }
.home-page .grantpal-heading { display: flex; flex-direction: column; align-items: flex-start; padding-left: 40px; }

/* ===== Sections ===== */
.home-page .project-wrapper { border: 2px solid #e6e6e6; background-color: #ffffff; border-radius: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.home-page .project-header { margin-bottom: 4px; }
.home-page .card-body-bordered { border: 1px solid #e6e6e6; border-radius: 15px; padding: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.home-page .custom-separator { border-top: 2px solid #999; margin-top: 8px !important; margin-bottom: 20px !important; }

/* ===== Horizontal scrollers for grant cards ===== */
.home-page .horizontal-scroll-wrapper {
  overflow-x: auto; overflow-y: hidden; white-space: nowrap; -webkit-overflow-scrolling: touch;
  padding-bottom: 6px;             /* avoids the scrollbar overlapping content */
}
.home-page .row.flex-nowrap { flex-wrap: nowrap; }
.home-page .custom-card-width { width: 400px; flex: 0 0 auto; }
.home-page .card, .card-body-bordered { word-wrap: break-word; overflow-wrap: break-word; white-space: normal; }

/* ===== Dropdown Styling ===== */
.home-page .small-dropdown { width: 130px; }
.home-page .status-dropdown { padding: 4px 10px; border-radius: 8px; font-size: 0.85rem; transition: background-color 0.3s, color 0.3s; }
.home-page .bg-warning { background-color: #F2F9E6 !important; color: #85A453 !important; }
.home-page .bg-info    { background-color: #FFEEBD !important; color: #91741F !important; }
.home-page .bg-danger  { background-color: #FFEDF3 !important; color: #C6195B !important; }
select.status-dropdown { font-weight: bold; }
.home-page .status-dropdown option[value="Not Started"] { background-color: #F2F9E6; color: #85A453; }
.home-page .status-dropdown option[value="In Progress"] { background-color: #FFEEBD; color: #91741F; }
.home-page .status-dropdown option[value="Urgent"]      { background-color: #FFEDF3; color: #C6195B; }

/* ===== Date input ===== */
input[type="date"].no-calendar-icon::-webkit-calendar-picker-indicator { display: none; -webkit-appearance: none; }

/* ===== Right column (toâ€‘do + calendar) â€” make 100% width and non-overflow ===== */
.home-page .col-right { min-width: 0; } /* allow it to shrink without forcing overflow */
.home-page .todolist-container,
.home-page .custom-calendar-container { width: 100%; }
.home-page .todolist-container {
  border: 1px solid #e6e6e6; border-radius: 8px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); background-color: #fff;
}
.home-page .todolist-heading { font-weight: 500; font-size: 20px; }
.home-page .todolist-button { width: 100%; display: block; margin-left: auto; margin-right: auto; }
.home-page .custom-list-item { padding-top: 12px; padding-bottom: 12px; border: 1px solid #e6e6e6 !important; border-radius: 8px !important; }
.home-page .todolist-divider { height: 1px; background-color: #e6e6e6; margin: 8px -15px 8px -15px; }
.home-page .collapsed-list { max-height: 255px; overflow-y: hidden; transition: max-height 0.5s ease-in-out; }
.home-page .collapsed-list.expanded { max-height: 1000px; }

.home-page .custom-tick {
  display: inline-flex; justify-content: center; align-items: center;
  width: 20px; height: 20px; border-radius: 50%;
  background-color: #FF00A1; color: white; font-size: 12px; line-height: 1; font-style: normal;
  cursor: pointer; transition: background-color 0.3s, border-color 0.3s;
}
.home-page .custom-tick::before { content: "\2713"; }
.home-page .custom-tick.outlined { background-color: transparent; border: 1px dashed #FF00A1; color: transparent; }
.home-page .custom-tick:hover { opacity: 0.85; }

/* ===== Embedded Google Calendar fits column width ===== */
.home-page .custom-calendar-container { border: 1px solid #e6e6e6; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.home-page .custom-calendar-container iframe { width: 100% !important; height: 400px; border: 0; border-radius: 12px; }
</style>

<div class="home-page">
  <div class="container-fluid">
    <div class="row">
      <!-- LEFT: main content -->
      <div class="col-md-9 main-content">
        <h3 class="mb-1">Grant Applications</h3>
        <h5 class="text-muted mb-4" style="font-weight: 400; font-size: 20px;">For Projects</h5>

        <div class="project-wrapper p-4 mb-4">
          <div class="project-list-container collapsed-projects">

            <!-- Being Guests -->
            <div class="mb-5">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="project-header" style="font-weight: 550;">Being Guests</h5>
                <img src="{{ url_for('static', filename='assets/tripledot.svg') }}" alt="Options" style="width:20px;height:20px;cursor:pointer;" />
              </div>
              <hr class="custom-separator" style="margin-bottom: 30px;"/>

              <div class="horizontal-scroll-wrapper mb-4">
                <div class="row flex-nowrap">
                  <!-- Card 1 -->
                  <div class="custom-card-width">
                    <div class="card mb-3">
                      <div class="card-body card-body-bordered">
                        <div class="mb-2">
                          <select class="form-select status-dropdown small-dropdown" style="max-width: 160px;">
                            <option value="Urgent" selected>Urgent</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                          </select>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <div class="d-flex align-items-center gap-2">
                            <input type="date" class="form-control no-calendar-icon date-input" style="width: 140px;" value="2025-08-02"/>
                            <i class="bi bi-calendar3 calendar-icon" style="font-size: 1.3rem; cursor: pointer;" title="Open calendar"></i>
                          </div>
                          <button class="btn btn-outline-secondary save-to-calendar-btn"
                                  data-title="Temasek Foundation" data-description="Being Guests">Save deadline</button>
                        </div>

                        <h6 class="mt-3">Temasek Foundation</h6>
                        <p class="small">Timeline: Projects should commence within 30 days<br/>Eligible Applicants: Individuals or groups<br/>Budget: Up to 80% sponsorship</p>

                        <div class="border rounded p-2 mb-2 bg-light shadow-sm">
                          <p class="mb-1 text-muted small">Last opened: 1 Jun</p>
                          <h6 class="mb-1">ðŸ“„ Project Proposal</h6>
                          <p class="small text-secondary mb-0">A 6-month plan to provide 500 care kits to seniors. Volunteers and clinics will be engaged to identify needs.</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Card 2 -->
                  <div class="custom-card-width">
                    <div class="card mb-3">
                      <div class="card-body card-body-bordered">
                        <div class="mb-2">
                          <select class="form-select status-dropdown small-dropdown" style="max-width: 160px;">
                            <option value="Urgent">Urgent</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Not Started">Not Started</option>
                          </select>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <div class="d-flex align-items-center gap-2">
                            <input type="date" class="form-control no-calendar-icon date-input" style="width: 140px;" value="2025-08-02"/>
                            <i class="bi bi-calendar3 calendar-icon" style="font-size: 1.3rem; cursor: pointer;" title="Open calendar"></i>
                          </div>
                          <button class="btn btn-outline-secondary save-to-calendar-btn"
                                  data-title="Tote Board" data-description="Being Guests">Save deadline</button>
                        </div>

                        <h6 class="mt-3">Tote Board</h6>
                        <p class="small">Timeline: Project must create positive community impact<br/>Eligible Applicants: Social service agencies or ground-up groups<br/>Budget: Up to $100,000</p>

                        <div class="border rounded p-2 mb-2 bg-light shadow-sm">
                          <p class="mb-1 text-muted small">Last opened: 12 Jul</p>
                          <h6 class="mb-1">ðŸ“„ Community Support Outreach</h6>
                          <p class="small text-secondary mb-0">This project supports vulnerable individuals through inclusive community initiatives and assistance.</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Card 3 -->
                  <div class="custom-card-width">
                    <div class="card mb-3">
                      <div class="card-body card-body-bordered">
                        <div class="mb-2">
                          <select class="form-select status-dropdown small-dropdown" style="max-width: 160px;">
                            <option value="Urgent">Urgent</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started" selected>Not Started</option>
                          </select>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <div class="d-flex align-items-center gap-2">
                            <input type="date" class="form-control no-calendar-icon date-input" style="width: 140px;" value="2025-08-02"/>
                            <i class="bi bi-calendar3 calendar-icon" style="font-size: 1.3rem; cursor: pointer;" title="Open calendar"></i>
                          </div>
                          <button class="btn btn-outline-secondary save-to-calendar-btn"
                                  data-title="Our Singapore Fund" data-description="Being Guests">Save deadline</button>
                        </div>

                        <h6 class="mt-3">Our Singapore Fund</h6>
                        <p class="small">Timeline: Projects must build social cohesion<br/>Eligible Applicants: Singapore Citizens or PRs<br/>Budget: Up to $20,000</p>

                        <div class="border rounded p-2 mb-2 bg-light shadow-sm">
                          <p class="mb-1 text-muted small">Last opened: 20 May</p>
                          <h6 class="mb-1">ðŸ“„ Neighborhood Kindness Campaign</h6>
                          <p class="small text-secondary mb-0">Promotes empathy and unity through neighborhood events and care drives.</p>
                        </div>
                      </div>
                    </div>
                  </div>

                </div><!-- /row flex-nowrap -->
              </div><!-- /horizontal scroll -->
            </div><!-- /Being Guests -->

            <!-- Care Companions (same structure trimmed for brevity) -->
            <!-- ... keep your existing cards here unchanged ... -->

            <!-- EcoNova Urban Gardens (same structure trimmed for brevity) -->
            <!-- ... keep your existing cards here unchanged ... -->

          </div><!-- /project-list-container -->
          <div class="project-divider"></div>
          <div class="text-center">
            <button class="btn toggle-projects-btn" style="border: none; background: none; padding: 0;">
              <i class="bi bi-chevron-down"></i>
            </button>
          </div>
        </div>

        <div class="text-center mt-4">
          <button class="btn btn-outline-secondary w-100">+ New Grant</button>
        </div>
      </div>

      <!-- RIGHT: to-do + calendar -->
      <div class="col-md-3 col-right">
        <div class="mb-4 todolist-container">
          <h5 class="todolist-heading">To-do List</h5>
          <ul class="list-group rounded-0 collapsed-list">
            <div class="d-flex align-items-center mb-2 list-item-wrapper">
              <li class="list-group-item custom-list-item">
                <div><span class="task-title">Temasek Foundation Application</span><small class="text-muted d-block">By Aug 25</small></div>
              </li>
              <i class="custom-tick ms-2 outlined"></i>
            </div>
            <div class="d-flex align-items-center mb-2 list-item-wrapper">
              <li class="list-group-item custom-list-item">
                <div><span class="task-title">Regenerate MCCY answers</span><small class="text-muted d-block">By Sep 05</small></div>
              </li>
              <i class="custom-tick ms-2 outlined"></i>
            </div>
            <div class="d-flex align-items-center mb-2 list-item-wrapper">
              <li class="list-group-item custom-list-item">
                <div><span class="task-title">Finalize MCCY Application</span><small class="text-muted d-block">By Sep 08</small></div>
              </li>
              <i class="custom-tick ms-2 outlined"></i>
            </div>
            <div class="d-flex align-items-center mb-2 list-item-wrapper">
              <li class="list-group-item custom-list-item">
                <div><span class="task-title">Care Companion Grant Applications</span><small class="text-muted d-block">By Sep 21</small></div>
              </li>
              <i class="custom-tick ms-2"></i>
            </div>
            <div class="d-flex align-items-center mb-2 list-item-wrapper">
              <li class="list-group-item custom-list-item">
                <div><span class="task-title">BeingGuests Grant Applications</span><small class="text-muted d-block">By Oct 02</small></div>
              </li>
              <i class="custom-tick ms-2"></i>
            </div>
          </ul>
          <div class="todolist-divider"></div>
          <div class="text-center">
            <button class="btn toggle-list-btn" style="border: none; background: none; padding: 0;">
              <i class="bi bi-chevron-down"></i>
            </button>
          </div>
        </div>

        <button class="btn btn-outline-secondary mt-2 todolist-button">+ New Task</button>

        <div class="mb-5 custom-calendar-container">
          <iframe
            src="https://calendar.google.com/calendar/embed?src=beingthebridges%40gmail.com&ctz=Asia%2FSingapore"
            scrolling="no">
          </iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- Success modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
      <div class="modal-body text-center">
        <div class="d-flex align-items-center justify-content-center mb-3">
          <i class="bi bi-check-circle-fill me-2" style="color:#e83e8c;font-size:1.5rem;"></i>
          <h5 class="fw-normal mb-0">Date added to Google Calendar!</h5>
        </div>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Done</button>
      </div>
    </div></div>
  </div>
</div>

<script>
// Status color handler
function updateStatusColor(dropdown) {
  dropdown.classList.remove("bg-warning","bg-info","bg-danger","text-white");
  if (dropdown.value === "Not Started") dropdown.classList.add("bg-warning");
  else if (dropdown.value === "In Progress") dropdown.classList.add("bg-info","text-white");
  else if (dropdown.value === "Urgent") dropdown.classList.add("bg-danger","text-white");
}
document.querySelectorAll('.status-dropdown').forEach(dd=>{
  updateStatusColor(dd);
  dd.addEventListener('change',()=>updateStatusColor(dd));
});

// Save to Calendar
document.querySelectorAll('.save-to-calendar-btn, .save-calendar-btn').forEach(button=>{
  button.addEventListener('click', async ()=>{
    const container = button.closest('.card-body');
    const dateInput = container.querySelector('input[type="date"]');
    const dueDate = dateInput?.value;
    const title = button.dataset.title, description = button.dataset.description;

    if (!dueDate) return alert("Please select a date before saving to calendar.");

    const res = await fetch('/add-to-calendar', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ title, description, date: dueDate }) // YYYY-MM-DD
    });
    let data = {};
    try { data = await res.json(); } catch {}
    if (res.ok && data.success) new bootstrap.Modal('#successModal').show();
    else alert(`âŒ Failed to add to calendar${data.error ? `: ${data.error}`:''}`);
  });
});

// Clickable calendar icon to open native picker
document.querySelectorAll('.calendar-icon').forEach(icon=>{
  icon.addEventListener('click', ()=>{
    const input = icon.previousElementSibling;
    if (input?.showPicker) input.showPicker(); else input?.focus();
  });
});

// Tick toggle
document.querySelectorAll('.custom-tick').forEach(t=>t.addEventListener('click',()=>t.classList.toggle('outlined')));

// Expanders
const projectsContainer = document.querySelector('.project-list-container');
const projectsToggleBtn = document.querySelector('.toggle-projects-btn');
const projectsToggleIcon = projectsToggleBtn.querySelector('.bi');
projectsToggleBtn.addEventListener('click', ()=>{
  projectsContainer.classList.toggle('expanded');
  projectsToggleIcon.classList.toggle('bi-chevron-up');
  projectsToggleIcon.classList.toggle('bi-chevron-down');
});

const todoList = document.querySelector('.todolist-container .list-group');
const todoToggleBtn = document.querySelector('.toggle-list-btn');
const todoToggleIcon = todoToggleBtn.querySelector('.bi');
todoToggleBtn.addEventListener('click', ()=>{
  todoList.classList.toggle('expanded');
  todoToggleIcon.classList.toggle('bi-chevron-up');
  todoToggleIcon.classList.toggle('bi-chevron-down');
});
</script>
{% endblock %}
